---
title: "ANOVA intra e inter"
subtitle: "PSI4035 Taller 12"
author: "dacarras"
output:
  html_document:
    theme: paper
    highlight: kate
    toc: true
    toc_float:
      collapsed: false
      smooth_scroll: false
    fig_width: 10 
    fig_height: 10 
---

<style>
  .main-container {
    max-width: 1600px !important;
  }
  .list-group-item.active,  
  .list-group-item.active:focus, 
  .list-group-item.active:hover {
    background-color: #373334;
  }
</style>


```{r setup, include=FALSE}
#--------------------------------------
# setup
#--------------------------------------

# knitr option
knitr::opts_chunk$set(dev = 'png')
options(knitr.kable.NA = '')
options(digits = 7)
options(scipen = 999999)

# remove all previous objects
rm(list = ls())

# fonts
Sys.setenv(LANG="en_US.UTF-8")


```

# Taller 12: ANOVA intra e inter

## Cargar datos

```{r , echo=TRUE, warning=FALSE}

#----------------------------------------------------------
# cargar datos
#----------------------------------------------------------

#--------------------------------------
# cargar dplyr
#--------------------------------------

library(dplyr)

#--------------------------------------
# datos Vik (2014, p252)
#--------------------------------------

table_20_1 <- read.table(text = "
subject   t1     t2      trt
7         19     14      -1
8         15     15      -1
9         16     16      -1
10        16      7       1
11        19      8       1
12        17      9       1
19        24     19      -1
20        24     20      -1
21        22     21      -1
22        23     10       1
23        19     11       1
24        20     12       1
", header = TRUE, stringsAsFactors = FALSE)


#--------------------------------------
# mostrar datos
#--------------------------------------

knitr::kable(table_20_1, digits = 3)

```

# Modelos entre e intra

## Componente para realizar inferencias entre personas

Vik (2014), en el capitulo 20, esta creando un centroide para separar las inferencias de interés de cada pregunta. Para crear estos centroides, emplea una formula como la siguiente (ecuación 18.3, p224):

$$W_{1} = \frac{\lambda_{1}T_{1}+\lambda_{2}T_{2}}{\sqrt{\lambda_{1}+\lambda_{2}}}$$

Donde,

- $\lambda_{1}$ =  1
- $\lambda_{2}$ = -1

Lambda 1 ($\lambda_{1}$) y lambda 2 ($\lambda_{2}$) los define con pesos 1 y -1, de modo tal que el centro de ambos puntajes, la distancia común entre ambos puntos, le permite al autor realizar inferencias sobre las diferencias **entre** las ocasiones, y **al interior** de las personas. Adicionalmente, divide, o estandariza estos pesos por la raiz cuadrada de la suma de estos pesos, de modo tal, que el componente generado siga estando en una *métrica* de los puntajes originales.

La diferencia con el ejercicio del capitulo 18, es que en el capitulo 20, Vik llama a este componente "$W_{0}$", y genera otro centroide. Esta vez, para realizar inferencias entre personas. Para estos efectos cambia la recodificación de los lambda, a `+1` y `+1`. De esta forma, re expresaremos la ecuación anterior, según como es implementado en el capitulo 20.

$$W_{0} = \frac{\lambda_{1}T_{1}+\lambda_{2}T_{2}}{\sqrt{\lambda_{1}+\lambda_{2}}}$$

Donde,

- $\lambda_{1}$ = 1
- $\lambda_{2}$ = 1

A continuación, vamos a crear el component $W_{0}$".


```{r , echo=TRUE, warning=FALSE}

#----------------------------------------------------------
# preparar datos
#----------------------------------------------------------

#--------------------------------------
# crear componente W_0
#--------------------------------------

data_between <- table_20_1 %>%
                mutate(lambda_1 =  1) %>%
                mutate(lambda_2 =  1) %>%
                mutate(w_0 = (lambda_1*t1+lambda_2*t2)/sqrt(lambda_1^2+lambda_2^2)) %>%
                dplyr::glimpse()

#--------------------------------------
# mostrar datos
#--------------------------------------

knitr::kable(data_between, digits = 3)


```

## Modelo de inferencia entre personas

```{r , echo=TRUE, warning=FALSE}

#----------------------------------------------------------
# ajustar modelos
#----------------------------------------------------------

#--------------------------------------
# formulas
#--------------------------------------

f01 <- as.formula(w_0  ~ + 1)
f02 <- as.formula(w_0  ~ + 1 + trt)

#--------------------------------------
# ajustar modelos
#--------------------------------------

m01 <- lm(f01, data = data_between)
m02 <- lm(f02, data = data_between)

#--------------------------------------
# tabla de modelos
#--------------------------------------

texreg::screenreg(
    list(m01, m02),
    star.symbol = "*", 
    center = TRUE, 
    doctype = FALSE,
    dcolumn = TRUE, 
    booktabs = TRUE,
    single.row = FALSE
    )

#--------------------------------------
# tabla f del modelo
#--------------------------------------

anova(m02)

#--------------------------------------
# output del modelo de regresion
#--------------------------------------

summary(m02)

```


## Componente para realizar inferencias intra personas


La diferencia con el ejercicio del capitulo 18, es que en el capitulo 20, Vik llama a este componente "$W_{0}$", y genera otro centroide. Esta vez, para realizar inferencias entre personas. Para estos efectos cambia la recodificación de los lambda, a `+1` y `+1`. De esta forma, re expresaremos la ecuación anterior, según como es implementado en el capitulo 20.

$$W_{1} = \frac{\lambda_{1}T_{1}+\lambda_{2}T_{2}}{\sqrt{\lambda_{1}+\lambda_{2}}}$$

Donde,

- $\lambda_{1}$ =  1
- $\lambda_{2}$ = -1

A continuación, vamos a crear el component $W_{0}$".


```{r , echo=TRUE, warning=FALSE}

#----------------------------------------------------------
# preparar datos
#----------------------------------------------------------

#--------------------------------------
# crear componente W_0
#--------------------------------------

data_model <- table_20_1 %>%
              mutate(lambda_1 =  1) %>%
              mutate(lambda_2 =  1) %>%
              mutate(w_0 = (lambda_1*t1+lambda_2*t2)/sqrt(lambda_1^2+lambda_2^2)) %>%
              dplyr::glimpse()

#--------------------------------------
# mostrar datos
#--------------------------------------

knitr::kable(data_model, digits = 3)


```

## Modelo de inferencia entre personas

```{r , echo=TRUE, warning=FALSE}

#----------------------------------------------------------
# ajustar modelos
#----------------------------------------------------------

#--------------------------------------
# formulas
#--------------------------------------

f01 <- as.formula(w_0  ~ + 1)
f02 <- as.formula(w_0  ~ + 1 + trt)

#--------------------------------------
# ajustar modelos
#--------------------------------------

m01 <- lm(f01, data = data_model)
m02 <- lm(f02, data = data_model)

#--------------------------------------
# tabla de modelos
#--------------------------------------

texreg::screenreg(
    list(m01, m02),
    star.symbol = "*", 
    center = TRUE, 
    doctype = FALSE,
    dcolumn = TRUE, 
    booktabs = TRUE,
    single.row = FALSE
    )

#--------------------------------------
# tabla f del modelo
#--------------------------------------

anova(m02)

#--------------------------------------
# output del modelo de regresion
#--------------------------------------

summary(m02)

```
